#!/usr/bin/env ruby -w

if File.exists?(File.join(File.expand_path('../..', __FILE__), '.git'))
  railties_path = File.expand_path('../../lib', __FILE__)
  $:.unshift(railties_path)
end

require 'optparse'
require 'cryptobox'
require 'em-websocket'

$verbose = false
options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: #{File.basename($PROGRAM_NAME)} [options]"

  opts.on("-v", "--[no-]verbose", "Run verbosely") do |v|
    $verbose = v
  end
  opts.on("-c", "--config PATH", "Configuration file path") do |path|
    options[:config] = path
  end
  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
  opts.on_tail("--version", "Show version") do
    puts "Cryptobox #{Cryptobox::VERSION}"
    exit
  end
end.parse!

#EventMachine.run do
#  EventMachine::WebSocket.start(:host => "0.0.0.0", :port => 8080) do |ws|
#    ws.onopen do
#      puts "WebSocket connection open"
#
#      # publish message to the client
#      ws.send "Hello Client"
#    end
#
#    ws.onclose { puts "Connection closed" }
#    ws.onmessage do |msg|
#      puts "Recieved message: #{msg}"
#      ws.send "Pong: #{msg}"
#    end
#  end
#end
