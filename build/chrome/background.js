var cryptobox={};cryptobox.json=null;cryptobox.measure=function(c,e){var d=Date.now(),b;var a=e();b=Date.now();console.log(c+" "+(b-d)+"ms");return a};cryptobox.open=function(e,f){var c=function(g,h){setTimeout(function(){try{var i=cryptobox.measure("decrypt",function(){var k=cryptobox.cipher.decrypt(e,g.pbkdf2.salt,g.ciphertext,g.pbkdf2.iterations,g.aes.keylen,g.aes.iv);return $.parseJSON(k)});h(i,null)}catch(j){h(null,"<%= @text[:incorrect_password] %> "+j)}},10)};if(cryptobox.json){c(cryptobox.json,f)}else{var b="wss://127.0.0.1:22790";if("WebSocket" in window){var d=setTimeout(function(){f(null,"<%= @text[:server_not_responding] %>")},5000);var a=new WebSocket(b);a.onopen=function(){};a.onmessage=function(g){clearTimeout(d);c($.parseJSON(g.data),f)};a.onclose=function(){}}else{f(null,"<%= @text[:no_websocket_support] %>")}}};cryptobox.lock={_timeoutNow:0,_timeoutId:0};cryptobox.lock.startTimeout=function(d,b,c){var a=document.getElementsByTagName("body")[0];a.addEventListener("mousemove",d);cryptobox.lock._timeout=b;cryptobox.lock._timeoutNow=cryptobox.lock._timeout;cryptobox.lock._timeoutId=window.setInterval(function(){cryptobox.lock._timeoutNow--;if(cryptobox.lock._timeoutNow<=0){cryptobox.lock.stopTimeout();c()}},1000*60)};cryptobox.lock.updateTimeout=function(){cryptobox.lock._timeoutNow=cryptobox.lock._timeout};cryptobox.lock.stopTimeout=function(){clearInterval(cryptobox.lock._timeoutId)};var fill={};chrome.extension.getBackgroundPage().startTimeout=function(){cryptobox.lock.startTimeout(cryptobox.lock.updateTimeout,cryptobox.config.lock_timeout_minutes,function(){chrome.extension.getBackgroundPage().json=null})};chrome.extension.getBackgroundPage().updateTimeout=function(){cryptobox.lock.updateTimeout()};chrome.extension.onRequest.addListener(function(e,d,b){var a=document.getElementsByTagName("body")[0];var c=document.createElement("textarea");a.appendChild(c);c.value=e.text;c.select();document.execCommand("copy",false,null);a.removeChild(c);b({})});chrome.tabs.onUpdated.addListener(function(a,c,b){if(c.status=="complete"&&a in fill){var d={type:"fillForm",cfg:fill[a]};chrome.tabs.sendMessage(a,d,function(){});delete fill[a]}});